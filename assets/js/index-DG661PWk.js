import{u as N}from"./useHandleData-DGO0-IdV.js";import{u as S}from"./useAuthButtons-B4KvSUpv.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-Tky8n9Ab.js";import{_ as V}from"./taskDrawer.vue_vue_type_script_setup_true_name_TaskDrawer_lang-C73V2Q1X.js";import{_ as B}from"./taskDialog.vue_vue_type_script_setup_true_name_TaskDialog_lang-a5cDG7Wd.js";import{d as T,h as c,L as v,b as a,r as i,F as m,o as M,c as P,w as n,u,_ as U,e as d,a0 as k,aR as E,$ as I,J}from"./index-nS8LAQjE.js";import{d as O,h as A,i as F}from"./user-DTiKZ10C.js";import{g as H}from"./task-DbQZa82_.js";import{t as j}from"./dict-Cu197DXt.js";import"./sortable.esm-CGHLlJBv.js";import"./plugin-vue_export-helper-DlAUqK2U.js";const q={class:"table-box"},z=T({name:"timingTask"}),se=T({...z,setup(G){const s=c(),_=v({}),y=e=>({list:e.list,total:e.total}),C=e=>{let t=JSON.parse(JSON.stringify(e));return t.createTime&&(t.startTime=t.createTime[0]),t.createTime&&(t.endTime=t.createTime[1]),delete t.createTime,H(t)},{BUTTONS:p}=S(),h=v([{type:"selection",fixed:"left",width:70},{prop:"id",label:"任务ID"},{prop:"taskName",label:"任务名称",width:120,search:{el:"input"}},{prop:"groupName",label:"分组名称",width:120},{prop:"Corn表达式",label:"corn"},{prop:"status",label:"状态",enum:j,search:{el:"tree-select",props:{filterable:!0}},fieldNames:{label:"label",value:"value"},width:90,render:e=>a(m,null,[p.value.status?{}:a(i("el-tag"),{type:e.row.status==0?"danger":e.row.status==1?"success":"warning"},{default:()=>[e.row.status==0?"终止":e.row.status==1?"运行中":"暂停"]})])},{prop:"description",label:"简述"},{prop:"jobCallAddress",label:"任务地址",width:180},{prop:"startTime",label:"任务开始时间",width:180},{prop:"endTime",label:"任务结束时间",width:180},{prop:"lastRunTime",label:"最近执行时间",width:180},{prop:"nextRunTime",label:"下次执行时间",width:180},{prop:"runCount",label:"执行次数",width:120},{prop:"errorCount",label:"出错次数",width:120},{prop:"lastErrorTime",label:"出错时间",width:180},{prop:"enabledMark",label:"是否启用",width:120,render:e=>a(m,null,[p.value.status?a(i("el-switch"),{"model-value":e.row.status,"active-text":e.row.status?"是":"否","active-value":1,"inactive-value":0,onClick:()=>w(e.row)},null):a(i("el-tag"),{type:e.row.status?"danger":"success"},{default:()=>[e.row.status?"是":"否"]})])},{prop:"deleteMark",label:"是否删除",width:120,render:e=>a(m,null,[p.value.status?a(i("el-switch"),{"model-value":e.row.status,"active-text":e.row.status?"是":"否","active-value":1,"inactive-value":0,onClick:()=>w(e.row)},null):a(i("el-tag"),{type:e.row.status?"danger":"success"},{default:()=>[e.row.status?"是":"否"]})])},{prop:"creatorTime",label:"创建时间",width:180},{prop:"lastModifyTime",label:"更新时间",width:180},{prop:"operation",label:"操作",fixed:"right",width:260}]),x=({newIndex:e,oldIndex:t})=>{var l;(l=s.value)==null||l.tableData,J.success("修改列表排序成功")},D=async e=>{var t;(t=s.value)==null||t.getTableList()},L=async e=>{var t,l;await N(O,{id:e},"删除所选用户信息"),(t=s.value)==null||t.clearSelection(),(l=s.value)==null||l.getTableList()},w=async e=>{var t;(t=s.value)==null||t.getTableList()},f=c(null),b=(e,t={})=>{var r,o;const l={title:e,isView:e==="查看",row:{...t},api:e==="新增"?A:e==="编辑"?F:void 0,getTableList:(r=s.value)==null?void 0:r.getTableList};(o=f.value)==null||o.parentParams(l)},g=c(null),$=(e,t={})=>{var r;const l={title:e,isView:!0,row:{...t}};(r=g.value)==null||r.parentParams(l)};return(e,t)=>{const l=i("el-button");return M(),P("div",q,[a(R,{ref_key:"proTable",ref:s,columns:h,"request-api":C,"init-param":_,"data-callback":y,onDragSort:x},{tableHeader:n(r=>[a(l,{type:"primary",icon:u(U),onClick:t[0]||(t[0]=o=>b("新增"))},{default:n(()=>t[1]||(t[1]=[d("新增")])),_:1},8,["icon"]),a(l,{type:"danger",icon:u(k),plain:"",disabled:!r.isSelected,onClick:o=>L(r.selectedListIds)},{default:n(()=>t[2]||(t[2]=[d(" 批量删除任务 ")])),_:2},1032,["icon","disabled","onClick"])]),operation:n(r=>[a(l,{type:"primary",link:"",icon:u(E),onClick:o=>$("查看日志",r.row)},{default:n(()=>t[3]||(t[3]=[d("查看日志")])),_:2},1032,["icon","onClick"]),a(l,{type:"primary",link:"",icon:u(I),onClick:o=>b("编辑",r.row)},{default:n(()=>t[4]||(t[4]=[d("编辑")])),_:2},1032,["icon","onClick"]),a(l,{type:"danger",link:"",icon:u(k),onClick:o=>D(r.row)},{default:n(()=>t[5]||(t[5]=[d("删除")])),_:2},1032,["icon","onClick"])]),_:1},8,["columns","init-param"]),a(V,{ref_key:"taskDrawerRef",ref:f},null,512),a(B,{ref_key:"taskDialogRef",ref:g},null,512)])}}});export{se as default};
